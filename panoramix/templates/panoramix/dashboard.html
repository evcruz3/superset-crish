{% extends "panoramix/base.html" %}

{% block head_css %}
    {{ super() }}
    {% for css in dashboard.css_files %}
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename=css) }}">
    {% endfor %}
    <link rel="stylesheet" href="{{ url_for('static', filename="jquery.gridster.min.css") }}">
<style>
    .gridster li {
        list-style-type: none;
        border: 1px solid gray;    
        overflow: auto;
        box-shadow: 2px 2px 2px #AAA;
        border-radius: 5px;
    }
    img.loading {
        width: 20px;
        margin: 5px;
    }
    .title {
        text-align: center;
    }
    .slice_title {
        text-align: center;
    }
    div.gridster {
        visibility: hidden
    }
    div.slice_content {
        width: 100%;
        height: 100%;
    }
</style>
{% endblock %}

{% block content_fluid %}
<div class="title"><h2>{{ dashboard.dashboard_title }}</h2></div>
<div class="gridster content_fluid">
    <ul>
        {% for slice in dashboard.slices %}
        <li 
            id="slice_{{ slice.id }}" 
            data-row="1"
            data-col="{{ loop.index }}"
            data-sizex="2" 
            data-sizey="2">
            <div class="slice_title">
                <h5>{{ slice.slice_name }}</h5>
            </div>
            <div id="slice_content_{{ slice.id }}"><img src="/static/loading.gif" class="loading"></div>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}

{% block tail %}
    {{ super() }}
    {% for js in dashboard.js_files %}
        <script src="{{ url_for('static', filename=js) }}"></script>
    {% endfor %}
    <script src="{{ url_for("static", filename="jquery.gridster.with-extras.min.js") }}"></script>
    <script src="{{ url_for("static", filename="d3.min.js") }}"></script>
    <script>
        f = d3.format(".4s");
    </script>
    <script>

$( document ).ready(function() {
    $(".gridster ul").gridster({
        widget_margins: [5, 5],
        widget_base_dimensions: [150, 150],
        resize: {enabled: true}
    });
    var url = "/panoramix/table/2/?flt_col_0=gender&rolling_periods=&datasource_id=2&flt_op_0=in&slice_name=Super%20Slice&viz_type=line&since=50%20years%20ago&groupby=name&metrics=total&limit=25&flt_eq_0=&granularity=one%20day&datasource_name=baby_names&where=&until=now&rolling_type=mean&datasource_type=table&skip_libs=true&standalone=true";
    $.ajax({
        url: url,
        success: function(result){
            $("#slice_content_2").html(result);
        },
        async: true,
    });
    var url = "/panoramix/table/2/?flt_col_0=gender&datasource_id=2&flt_op_0=in&viz_type=pie&since=50%20years%20ago&until=now&metrics=total&limit=10&granularity=one%20day&datasource_name=baby_names&slice_name=Pie&where=&groupby=name&flt_eq_0=&datasource_type=table&skip_libs=true&standalone=true";
    $.ajax({
        url: url,
        success: function(result){
            $("#slice_content_3").html(result);
        },
        async: true,
    });
    $("div.gridster").css('visibility', 'visible');
});
    </script>

{% endblock %}

